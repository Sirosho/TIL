# SQL 집합 연산자 정리

## Part 1. 결과를 위아래로 합치는 연산자

`JOIN`이 여러 테이블을 수평(좌우)으로 연결한다면, 집합 연산자는 여러 `SELECT` 문의 결과를 수직(상하)으로 연결하여 하나의 결과 집합으로 만든다.

<div style="margin-top:80px;"></div>

### 1. 집합 연산자의 기본 규칙

집합 연산자를 사용하기 위해서는 합치려는 모든 `SELECT` 문이 다음의 규칙을 반드시 준수해야 한다.

1.  **컬럼의 개수가 같아야 한다.**
2.  각 `SELECT` 문의 대응되는 **컬럼의 데이터 타입이 서로 호환 가능해야** 한다. (예: 숫자 타입과 숫자 타입)
3.  최종 결과의 **컬럼명은 첫 번째 `SELECT` 문의 것을 따라간다.** 따라서 컬럼명을 지정하고 싶다면 첫 번째 `SELECT` 문에 별칭(Alias)을 사용해야 한다.

```sql
-- 첫 번째 SELECT 문의 별칭인 "활동 유저 ID"가 최종 결과의 컬럼명이 된다.
SELECT user_id AS "활동 유저 ID" FROM LIKES
UNION
SELECT user_id FROM COMMENTS;
```


<div style="margin-top:80px;"></div>

### 2. UNION ALL: 모든 결과 합치기

`UNION ALL`은 두 `SELECT` 문의 결과를 중복 제거나 정렬 과정 없이 그대로 이어 붙이는 가장 단순한 방식이다.

-   **개념**: 두 결과 집합을 그대로 합친다. (합집합)
-   **특징**: 중복을 허용하며, 별도의 정렬을 수행하지 않아 `UNION`보다 성능이 빠르다.

> '좋아요'를 누른 기록과 '댓글'을 작성한 기록을 모두 합쳐 전체 활동 로그를 만들 때 사용된다. 한 사용자가 여러 번 활동했다면 그 횟수만큼 결과에 모두 포함된다.

```sql
-- '좋아요'를 누른 사용자 ID 목록 전체
SELECT user_id FROM LIKES
UNION ALL
-- '댓글'을 작성한 사용자 ID 목록 전체
SELECT user_id FROM COMMENTS;
```


<div style="margin-top:80px;"></div>

### 3. UNION: 중복을 제외하고 합치기

`UNION`은 두 `SELECT` 문의 결과를 합친 후, 중복된 행을 자동으로 제거하여 고유한 값만 남긴다.

-   **개념**: 중복을 제거한 결과 집합을 만든다. (합집합)
-   **특징**: 중복 제거를 위해 내부적으로 정렬 과정을 거치며, 최종 결과도 기본적으로 정렬된다.

> '좋아요' 또는 '댓글' 활동을 한 번이라도 한 사용자가 누구인지, 순수한 '활동 유저' 목록을 확인할 때 사용된다. 한 사용자가 여러 번 활동했더라도 결과에는 단 한 번만 표시된다.

```sql
-- '좋아요'를 누른 고유한 사용자 ID 목록
SELECT user_id FROM LIKES
UNION
-- '댓글'을 작성한 고유한 사용자 ID 목록
SELECT user_id FROM COMMENTS;
```


<div style="margin-top:80px;"></div>

## Part 2. 결과를 비교하는 연산자

두 결과 집합을 비교하여 공통되거나 차이가 나는 특정 그룹을 정교하게 식별할 때 사용된다.

<div style="margin-top:80px;"></div>

### 4. INTERSECT: 공통된 결과만 조회 (교집합)

`INTERSECT`는 두 `SELECT` 문의 결과에 공통으로 존재하는 행만 반환한다.

-   **개념**: 두 결과 집합의 교집합을 구한다.
-   **특징**: `UNION`과 마찬가지로 중복을 제거하고 결과를 자동으로 정렬한다.

> '좋아요'도 누르고 '댓글'도 작성한 '열성 사용자' 목록을 찾을 때 사용된다.

```sql
-- '좋아요'를 누른 사용자 목록
SELECT user_id FROM LIKES
INTERSECT
-- '댓글'을 작성한 사용자 목록
SELECT user_id FROM COMMENTS;
```

<div style="margin-top:80px;"></div>

### 5. MINUS: 특정 결과를 제외하고 조회 (차집합)

`MINUS`는 첫 번째 `SELECT` 문의 결과에서 두 번째 `SELECT` 문의 결과에 포함된 행을 제외한 나머지를 반환한다.

-   **개념**: 두 결과 집합의 차집합을 구한다.
-   **특징**: 연산자의 순서가 매우 중요하다. `A MINUS B`와 `B MINUS A`는 완전히 다른 결과를 반환한다.

> '좋아요'는 눌렀지만 '댓글'은 작성하지 않은 '샤이 사용자' 목록을 찾을 때 사용된다.

```sql
-- '좋아요'를 누른 사용자 중에서
SELECT user_id FROM LIKES
MINUS
-- '댓글'을 작성한 사용자는 제외한다.
SELECT user_id FROM COMMENTS;
```

<div style="margin-top:80px;"></div>

### ※ 서브쿼리 대신 집합 연산자를 사용하는 이유

`WHERE ... IN` 과 같은 서브쿼리로도 교집합이나 차집합을 구현할 수 있지만, 집합 연산자는 다음과 같은 장점을 가진다.

1.  **가독성**: `A INTERSECT B` 와 같은 코드는 "A와 B의 교집합을 구한다"는 개발자의 의도를 서브쿼리보다 훨씬 명확하고 직관적으로 보여준다.
2.  **성능**: 경우에 따라, 특히 대용량 데이터를 다룰 때 데이터베이스 옵티마이저가 집합 연산자를 더 효율적인 실행 계획으로 해석하여 성능상 이점을 가질 수 있다.
3.  **통일성**: 컬럼 수와 데이터 타입 일치를 강제하는 규칙 덕분에 더 정제되고 예측 가능한 결과를 만들 수 있다.